<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>PETTY - ë°˜ë ¤ë™ë¬¼ ë¶„ì„</title>
    <link rel="stylesheet" th:href="@{/css/common.css}" />
    <!-- src\main\resources\static\css\common.css -->
    <link rel="stylesheet" th:href="@{/css/header.css}" />
    <link rel="stylesheet" th:href="@{/css/navbar.css}" />
    <style>
        /* analyze.html í˜ì´ì§€ì—ë§Œ íŠ¹í™”ëœ CSS */
        .image-preview-container {
            margin-top: 20px;
            text-align: center;
            border: 1px dashed var(--input-border-color);
            border-radius: var(--border-radius-md);
            padding: 15px;
            display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
            background-color: var(--background-color);
        }
        .image-preview-container img {
            max-width: 100%;
            height: auto;
            max-height: 200px; /* í”„ë¦¬ë·° ì´ë¯¸ì§€ì˜ ìµœëŒ€ ë†’ì´ ì„¤ì • */
            border-radius: var(--border-radius-sm);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .image-preview-container p {
            margin-top: 10px;
            color: var(--secondary-text-color);
            font-size: 0.9em;
        }
    </style>
</head>
<body onclick="closeMenuOnClickOutside(event)">

<div th:replace="fragments/header :: mainHeader"></div>
<div th:replace="fragments/navbar :: sideMenuContent"></div>

<main>
    <h1>ğŸ¾ ë°˜ë ¤ë™ë¬¼ ì—¬í–‰ì§€ ì¶”ì²œ</h1>

    <form th:action="@{/flow/analyze}" method="post" enctype="multipart/form-data">
        <label for="petName">ë°˜ë ¤ë™ë¬¼ ì´ë¦„</label>
        <input type="text" name="petName" id="petName" required />

        <label for="file">ë°˜ë ¤ë™ë¬¼ ì´ë¯¸ì§€</label>
        <input type="file" name="file" id="file" accept="image/*" required />

        <div class="image-preview-container" id="imagePreviewContainer">
            <img id="imagePreview" src="#" alt="Image Preview" />
            <p>ì„ íƒëœ ì´ë¯¸ì§€</p>
        </div>

        <input type="submit" value="ë‚´ ë°˜ë ¤ë™ë¬¼ ë¶„ì„í•˜ê¸°" />
    </form>

    <div class="result-block" th:if="${error}">
        <h2>ì˜¤ë¥˜ ë°œìƒ</h2>
        <p th:text="${error}" style="color: red;"></p>
    </div>
</main>

<div th:replace="fragments/_footer :: mainFooter"></div>

<script th:src="@{/js/flow.js}"></script> <script>
    // ì´ë¯¸ì§€ í”„ë¦¬ë·° ê¸°ëŠ¥
    document.addEventListener('DOMContentLoaded', function() {
        const fileInput = document.getElementById('file');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const imagePreview = document.getElementById('imagePreview');

        fileInput.addEventListener('change', function(event) {
            const file = event.target.files[0]; // ì„ íƒëœ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°

            if (file) {
                const reader = new FileReader(); // FileReader ê°ì²´ ìƒì„±

                reader.onload = function(e) {
                    imagePreview.src = e.target.result; // ì´ë¯¸ì§€ srcì— ë°ì´í„° URL ì„¤ì •
                    imagePreviewContainer.style.display = 'block'; // í”„ë¦¬ë·° ì»¨í…Œì´ë„ˆ ë³´ì´ê¸°
                };

                reader.readAsDataURL(file); // íŒŒì¼ì„ Data URL í˜•ì‹ìœ¼ë¡œ ì½ê¸°
            } else {
                imagePreview.src = '#'; // íŒŒì¼ì´ ì—†ìœ¼ë©´ ì´ë¯¸ì§€ src ì´ˆê¸°í™”
                imagePreviewContainer.style.display = 'none'; // í”„ë¦¬ë·° ì»¨í…Œì´ë„ˆ ìˆ¨ê¸°ê¸°
            }
        });
    });
</script>
</body>
</html>