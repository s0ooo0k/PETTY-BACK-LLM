<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PETTY - 회원가입</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans KR', sans-serif;
        }
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #f39c12;
        }
        .logo {
            text-align: center;
            margin-bottom: 20px;
        }
        .logo img {
            width: 120px;
        }
        .terms-container {
            margin-bottom: 20px;
        }
        .terms-box {
            height: 300px;
            overflow-y: auto;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
            margin-bottom: 15px;
            font-size: 14px;
        }
        .terms-box h3 {
            margin-top: 15px;
            margin-bottom: 10px;
        }
        .terms-box p {
            margin-bottom: 10px;
        }
        .terms-box ul {
            padding-left: 20px;
            margin-bottom: 10px;
        }
        .agreement {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .agreement input {
            margin-right: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .pet-info {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 15px;
            background-color: #F8B85C;
        }
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn-primary {
            background-color: #f39c12;
            color: #fff;
            width: 100%;
        }
        .btn-primary:hover {
            background-color: #f39c12;
        }
        .btn-primary:disabled {
            background-color: #F8B85C;
            cursor: not-allowed;
        }
        .signup-form {
            display: none;
        }
        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
        }
        .pet-type-select {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="logo">
        <h1>PETTY</h1>
        <p>반려동물과 함께하는 여행 서비스</p>
    </div>

    <div class="terms-container">
        <h2>이용약관 동의</h2>
        <div class="terms-box">
            <h3>제1조 (목적)</h3>
            <p>이 약관은 "PETTY" (이하 "서비스")의 회원가입과 관련된 이용 조건 및 절차, 회원의 권리와 의무를 규정하는 것을 목적으로 합니다.</p>

            <h3>제2조 (정의)</h3>
            <p>1. "서비스"란 반려동물 동반 가능 숙소 및 관광지 정보를 제공하고, 위치 기반 추천 및 자연어 처리 기능을 통해 사용자가 반려동물과 함께 여행할 수 있는 장소를 추천하는 온라인 플랫폼을 의미합니다.</p>
            <p>2. "회원"이란 본 약관에 동의하고, 서비스에 가입한 사용자를 의미합니다.</p>
            <p>3. "아이디(ID)"란 회원이 서비스를 이용하기 위해 등록한 고유의 문자와 숫자 조합을 의미합니다.</p>
            <p>4. "비밀번호"란 회원의 아이디와 일치하는 서비스 이용을 보호하기 위한 비밀 번호를 의미합니다.</p>
            <p>5. "개인정보"란 서비스 제공을 위해 수집된 회원의 개인 정보로, 이름, 연락처, 이메일, 반려동물 정보 등을 포함합니다.</p>

            <h3>제3조 (약관의 동의 및 변경)</h3>
            <p>1. 회원은 서비스 이용을 위해 본 약관에 동의해야 합니다.</p>
            <p>2. 본 약관은 서비스 화면에 게시함으로써 효력을 발생합니다.</p>
            <p>3. 회사는 사전 공지 없이 약관을 변경할 수 있으며, 변경된 약관은 공지한 날로부터 7일 이후 효력이 발생합니다.</p>

            <h3>제4조 (회원 가입)</h3>
            <p>1. 회원 가입은 서비스 이용을 원하는 사람이 본 약관에 동의하고, 회원 가입 절차를 통해 가입 신청을 완료한 후 이루어집니다.</p>
            <p>2. 가입 신청자는 반드시 본인의 정보(이름, 이메일, 반려동물 정보 등)를 정확하게 입력해야 하며, 잘못된 정보를 입력한 경우 서비스 이용에 제한을 받을 수 있습니다.</p>
            <p>3. 서비스는 회원 가입 신청에 대해 승낙을 거부할 수 있으며, 이 경우 가입 신청자에게 그 사유를 알려야 합니다.</p>

            <h3>제5조 (회원 정보의 보호)</h3>
            <p>1. 서비스는 회원의 개인정보를 보호하기 위해 최선을 다하며, 개인정보는 관련 법령에 따라 처리됩니다.</p>
            <p>2. 회원은 본인의 개인정보가 변경된 경우 이를 즉시 서비스에 통지해야 하며, 이를 통지하지 않아 발생하는 문제에 대해서는 회원이 책임을 집니다.</p>

            <h3>제6조 (서비스 이용)</h3>
            <p>1. 회원은 서비스 제공에 따라 다양한 기능을 이용할 수 있습니다.</p>
            <p>2. 회원은 반려동물 정보(종, 크기, 맹견 여부 등)를 정확하게 입력해야 하며, 해당 정보는 추천 기능 및 장소 검색에 활용됩니다.</p>
            <p>3. 서비스는 자연어 처리 및 위치 기반 추천 기능을 제공하며, 회원은 이를 통해 반려동물 동반 가능 장소를 추천받을 수 있습니다.</p>
            <p>4. 서비스의 추천 기능은 Vision API, 공공데이터포털 API 등을 통해 제공되는 데이터를 기반으로 하며, 그 정확성은 보장되지 않습니다.</p>

            <h3>제7조 (회원의 의무)</h3>
            <p>1. 회원은 서비스를 이용할 때 법적 책임을 준수해야 하며, 타인의 권리를 침해하는 행동을 하지 않아야 합니다.</p>
            <p>2. 회원은 서비스 이용 시 다음의 행위를 해서는 안 됩니다:</p>
            <ul>
                <li>불법적인 목적을 위해 서비스를 이용하는 행위</li>
                <li>타인의 개인정보를 수집하거나 유출하는 행위</li>
                <li>서비스의 정상적인 운영을 방해하는 행위</li>
            </ul>

            <h3>제8조 (서비스의 제공과 변경)</h3>
            <p>1. 서비스는 제공하는 기능을 변경하거나 종료할 수 있습니다.</p>
            <p>2. 서비스가 제공하는 기능 변경 시, 회원에게 사전 통지를 할 수 있으며, 회원은 통지 후 변경된 내용을 확인하고 이용할 수 있습니다.</p>

            <h3>제9조 (서비스의 이용 제한)</h3>
            <p>1. 서비스는 다음의 사유로 회원의 서비스 이용을 제한할 수 있습니다:</p>
            <ul>
                <li>본 약관을 위반한 경우</li>
                <li>불법적인 행위가 의심되는 경우</li>
                <li>서비스 운영에 방해가 되는 행위를 한 경우</li>
            </ul>
            <p>2. 회원은 서비스의 이용 제한에 대해 이의 제기할 수 없으며, 서비스는 이를 사전 통지 없이 진행할 수 있습니다.</p>

            <h3>제10조 (회원 탈퇴)</h3>
            <p>1. 회원은 언제든지 서비스에서 탈퇴할 수 있습니다. 탈퇴 시, 서비스에 등록된 회원의 모든 정보는 <strong>비활성화</strong> 또는 <strong>삭제 처리</strong>될 수 있습니다. 단, 법적인 의무나 서비스 운영상 필요에 따라 일부 정보는 일정 기간 동안 보유될 수 있습니다.</p>
            <p>2. 회원 탈퇴는 서비스의 탈퇴 절차를 통해 이루어집니다. 탈퇴 처리된 회원은 서비스 이용이 제한되며, <strong>비활성화된 정보는 복구가 불가능</strong>할 수 있습니다.</p>

            <h3>제11조 (책임의 제한)</h3>
            <p>1. 서비스는 회원에게 제공되는 콘텐츠 및 서비스에 대한 정확성, 신뢰성에 대해 책임을 지지 않습니다.</p>
            <p>2. 서비스는 기술적 문제나 시스템 오류로 인한 피해에 대해서는 책임을 지지 않습니다.</p>
            <p>3. 서비스는 공공데이터 및 외부 API를 기반으로 추천 기능을 제공하므로, 해당 데이터의 정확성 및 최신성에 대한 보장은 하지 않습니다.</p>

            <h3>제12조 (분쟁 해결)</h3>
            <p>1. 본 약관과 관련된 분쟁에 대해서는 서비스의 본사가 위치한 지역의 법원을 제1심 법원으로 합니다.</p>
            <p>2. 서비스와 회원 간에 분쟁이 발생한 경우, 양측은 상호 협의하여 해결하려 노력해야 합니다.</p>
        </div>

        <div class="agreement">
            <input type="checkbox" id="agree-terms" name="agree-terms">
            <label for="agree-terms">위 약관에 동의합니다. (필수)</label>
        </div>

        <button id="agree-btn" class="btn btn-primary" disabled>동의하고 가입하기</button>
    </div>

    <div id="signup-form" class="signup-form">
        <h2>회원 정보 입력</h2>
        <form id="registration-form" th:action="@{/join}" method="post" th:object="${JoinDTO}">
            <div class="form-group">
                <label for="email">이메일</label>
                <div class="email-group">
                    <input type="email" id="email" class="form-control" required placeholder="example@email.com" th:field="*{username}">
                    <button type="button" id="send-verification-btn" class="btn btn-secondary">인증코드 발송</button>
                </div>
                <div class="error-message" id="email-error"></div>
            </div>

            <div class="form-group" id="verification-section" style="display: none;">
                <label for="verification-code">이메일 인증코드</label>
                <div class="verification-input-group">
                    <input type="text" id="verification-code" name="verification-code" class="form-control" placeholder="인증코드 6자리 입력" maxlength="6" autocomplete="one-time-code">
                    <span class="timer" id="verification-timer">05:00</span>
                </div>
                <div class="verification-group">
                    <button type="button" id="resend-code-btn" class="btn btn-secondary">인증코드 재발송</button>
                    <button type="button" id="confirm-code-btn" class="btn btn-verify">인증 확인</button>
                </div>
                <div class="error-message" id="verification-error"></div>
                <div class="success-message" id="verification-success"></div>
                <input type="hidden" id="is-email-verified" name="emailVerified" value="false">
            </div>

            <div class="form-group">
                <label for="password">비밀번호</label>
                <input type="password" id="password" class="form-control" required placeholder="8자 이상의 영문, 숫자, 특수문자 조합" th:field="*{password}" autocomplete="new-password">
                <div class="error-message" id="password-error"></div>
            </div>

            <div class="form-group">
                <label for="confirm-password">비밀번호 확인</label>
                <input type="password" id="confirm-password" class="form-control" required placeholder="비밀번호를 다시 입력해주세요" autocomplete="new-password">
                <div class="error-message" id="confirm-password-error"></div>
            </div>

            <div class="form-group">
                <label for="name">이름</label>
                <input type="text" id="name" class="form-control" required placeholder="이름을 입력해주세요" th:field="*{name}">
                <div class="error-message" th:errors="*{name}"></div>
            </div>

            <div class="form-group">
                <label for="phone">연락처</label>
                <input type="tel" id="phone" class="form-control" required placeholder="'-' 없이 입력해주세요" th:field="*{phone}">
                <div class="error-message" id="phone-error"></div>
            </div>
            <!--
                        <h3>반려동물 정보</h3>
                        <div class="pet-info">
                            <div class="form-group">
                                <label for="pet-name">반려동물 이름 *</label>
                                <input type="text" id="pet-name" name="pet-name" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label>반려동물 종류 *</label>
                                <div class="pet-type-select">
                                    <div>
                                        <input type="radio" id="pet-dog" name="pet-type" value="dog" checked>
                                        <label for="pet-dog">강아지</label>
                                    </div>
                                    <div>
                                        <input type="radio" id="pet-cat" name="pet-type" value="cat">
                                        <label for="pet-cat">고양이</label>
                                    </div>
                                    <div>
                                        <input type="radio" id="pet-other" name="pet-type" value="other">
                                        <label for="pet-other">기타</label>
                                    </div>
                                </div>
                                <input type="text" id="pet-type-other" name="pet-type-other" class="form-control" style="display: none;" placeholder="반려동물 종류를 입력해주세요">
                            </div>

                            <div class="form-group">
                                <label>반려동물 크기 *</label>
                                <div class="pet-type-select">
                                    <div>
                                        <input type="radio" id="pet-size-small" name="pet-size" value="small" checked>
                                        <label for="pet-size-small">소형 (10kg 미만)</label>
                                    </div>
                                    <div>
                                        <input type="radio" id="pet-size-medium" name="pet-size" value="medium">
                                        <label for="pet-size-medium">중형 (10kg~25kg)</label>
                                    </div>
                                    <div>
                                        <input type="radio" id="pet-size-large" name="pet-size" value="large">
                                        <label for="pet-size-large">대형 (25kg 이상)</label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>맹견 여부 *</label>
                                <div class="pet-type-select">
                                    <div>
                                        <input type="radio" id="dangerous-yes" name="dangerous" value="yes">
                                        <label for="dangerous-yes">예</label>
                                    </div>
                                    <div>
                                        <input type="radio" id="dangerous-no" name="dangerous" value="no" checked>
                                        <label for="dangerous-no">아니오</label>
                                    </div>
                                </div>
                            </div>
                        </div>
            -->
            <button type="submit" class="btn btn-primary">회원가입 완료</button>
        </form>
    </div>
</div>

<script>
    // 약관 동의 체크박스 이벤트
    document.getElementById('agree-terms').addEventListener('change', function() {
        document.getElementById('agree-btn').disabled = !this.checked;
    });

    // 동의하고 가입하기 버튼 클릭 이벤트
    document.getElementById('agree-btn').addEventListener('click', function() {
        document.querySelector('.terms-container').style.display = 'none';
        document.getElementById('signup-form').style.display = 'block';
    });

    // 비밀번호 확인 실시간 검증
    document.getElementById('confirm-password').addEventListener('input', validatePasswordMatch);
    document.getElementById('password').addEventListener('input', function() {
        if(document.getElementById('confirm-password').value) {
            validatePasswordMatch();
        }
    });

    function validatePasswordMatch() {
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm-password').value;
        const passwordErrorElement = document.getElementById('confirm-password-error');

        if(confirmPassword && password !== confirmPassword) {
            passwordErrorElement.textContent = '비밀번호가 일치하지 않습니다.';
            return false;
        } else {
            passwordErrorElement.textContent = '';
            return true;
        }
    }

    // 이메일 인증 발송 버튼 클릭 이벤트
    document.getElementById('send-verification-btn').addEventListener('click', async function() {
        document.getElementById('send-verification-btn').disabled = true;
        const email = document.getElementById('email').value;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if (!emailRegex.test(email)) {
            document.getElementById('email-error').textContent = '유효한 이메일 주소를 입력해주세요.';
            return;
        }

        try {
            // 인증 코드 요청 AJAX
            const response = await fetch('/api/auth/send-verification', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email: email })
            });

            const data = await response.json();

            if (data.success) {
                document.getElementById('verification-section').style.display = 'block';
                document.getElementById('email-error').textContent = '';
                startTimer();
                alert('인증코드가 발송되었습니다. 이메일을 확인해주세요.');
            } else {
                document.getElementById('send-verification-btn').disabled = false;
                document.getElementById('email-error').textContent = data.message || '인증코드 발송에 실패했습니다.';
            }
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('email-error').textContent = '서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요.';
            document.getElementById('send-verification-btn').disabled = false;

        }
    });


    // 인증코드 재발송 버튼 클릭 이벤트
    document.getElementById('resend-code-btn').addEventListener('click', async function() {
        const email = document.getElementById('email').value;
        document.getElementById('resend-code-btn').disabled = true;

        // 인증 코드 재발송 AJAX
        await fetch('/api/auth/send-verification', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email: email })
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    resetTimer();
                    alert('인증코드가 재발송되었습니다. 이메일을 확인해주세요.');
                } else {
                    document.getElementById('resend-code-btn').disabled = false;
                    document.getElementById('verification-error').textContent = data.message || '인증코드 재발송에 실패했습니다.';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('resend-code-btn').disabled = false;
                document.getElementById('verification-error').textContent = '서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요.';
            });
    });

    // 인증 확인 버튼 클릭 이벤트
    document.getElementById('confirm-code-btn').addEventListener('click', function() {
        const email = document.getElementById('email').value;
        const code = document.getElementById('verification-code').value;

        if (!code || code.length !== 6) {
            document.getElementById('verification-error').textContent = '6자리 인증코드를 입력해주세요.';
            return;
        }

        // 인증 코드 확인 AJAX
        fetch('/api/auth/verify-code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                email: email,
                verificationCode: code
            })
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('verification-success').textContent = '이메일 인증이 완료되었습니다.';
                    document.getElementById('verification-error').textContent = '';
                    document.getElementById('is-email-verified').value = 'true';

                    // 인증 완료 후 입력창 비활성화
                    document.getElementById('verification-code').disabled = true;
                    document.getElementById('resend-code-btn').disabled = true;
                    document.getElementById('confirm-code-btn').disabled = true;
                    document.getElementById('verification-timer').style.display = 'none';

                    stopTimer();
                } else {
                    document.getElementById('verification-error').textContent = data.message || '인증코드가 일치하지 않습니다.';
                    document.getElementById('verification-success').textContent = '';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('verification-error').textContent = '서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요.';
            });
    });

    // 타이머 기능
    let timerInterval;
    function startTimer() {
        let minutes = 5;
        let seconds = 0;

        const timerElement = document.getElementById('verification-timer');
        timerElement.textContent = formatTime(minutes, seconds);

        clearInterval(timerInterval);
        timerInterval = setInterval(function() {
            if (seconds === 0) {
                if (minutes === 0) {
                    clearInterval(timerInterval);
                    timerElement.textContent = '00:00';
                    document.getElementById('verification-error').textContent = '인증 시간이 만료되었습니다. 코드를 재발송해주세요.';
                    return;
                }
                minutes--;
                seconds = 59;
            } else {
                seconds--;
            }

            timerElement.textContent = formatTime(minutes, seconds);
        }, 1000);
    }

    function resetTimer() {
        clearInterval(timerInterval);
        startTimer();
    }

    function stopTimer() {
        clearInterval(timerInterval);
    }

    function formatTime(minutes, seconds) {
        return (minutes < 10 ? '0' + minutes : minutes) + ':' + (seconds < 10 ? '0' + seconds : seconds);
    }

    // 폼 제출 전 유효성 검사
    document.getElementById('registration-form').addEventListener('submit', function(e) {
        const passwordErrorElement = document.getElementById('password-error');
        const phoneErrorElement = document.getElementById('phone-error');

        let isValid = true;

        // 이메일 인증 여부 검사
        if (document.getElementById('is-email-verified').value !== 'true') {
            e.preventDefault();
            document.getElementById('email-error').textContent = '이메일 인증을 완료해주세요.';
            isValid = false;
        }

        // 비밀번호 정규식 검사
        const password = document.getElementById('password').value;
        const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;
        if (!passwordRegex.test(password)) {
            e.preventDefault();
            passwordErrorElement.textContent = '비밀번호는 8자 이상의 영문, 숫자, 특수문자 조합이어야 합니다.';
            isValid = false;
        }

        // 비밀번호 확인 일치 검사
        if (!validatePasswordMatch()) {
            e.preventDefault();
            isValid = false;
        }

        // 전화번호 형식 검사
        const phone = document.getElementById('phone').value;
        const phoneRegex = /^01[016789]\d{7,8}$/;
        phoneErrorElement.textContent = '';
        if (!phoneRegex.test(phone)) {
            e.preventDefault();
            phoneErrorElement.textContent = '유효한 전화번호를 입력해주세요. (예: 01012345678)';
            isValid = false;
        }

        return isValid;
    });
</script>
</body>
</html>